# 第一部分：计算机网络体系结构

因特网是极为复杂的系统,它包含大量的软件以及硬件系统,大量的应用程序和协议、各种类型的端系统、分组交换机,面对这种庞大且复杂的系统,将其化简分层是极其有必要的,分层的好处如下：

各层之间相互独立、相关隔离。每层只考虑当前层如何实现，无需考虑其他层
提高整体结构的灵活性，层次之间结构解耦合
大问题变小，复杂问题变简单

<img src="C:\Users\hongj\AppData\Roaming\Typora\typora-user-images\image-20231024142013287.png" alt="image-20231024142013287" style="zoom:50%;" />

**本章高频面试题**

- 计算机网络为什么要分层？
- 计算机网络是怎么分层的？
- 三种计算机网络模型的关系是什么？每一层分别包含哪些协议？
- 计算机网络中，数据如何在各层中传播？数据在网络各层中的存在形式是怎么样的？



## OSI 七层模型

OSI(Open System Interconnection Reference Model) 模型是国际标准化组织 ISO（International Organization for Standardization) 提出的一个试图使各种计算机在世界范围内互连为网络的标准框架。
OSI 将计算机网络体系结构划分为七层，每一层实现各自的功能和协议，并完成与相邻层的接口通信。OSI 的服务定义详细说明了各层所提供的服务。

- 应用层：通过应用程序间的交互来完成特定的网络应用
- 表示层：解释交换数据的含义。该层提供的服务主要包括数据压缩，数据加密以及数据描述。
- 会话层：负责建立、管理和终止表示层实体之间的通信会话。该层提供了数据交换的定界和同步功能，包括了建立检查点和恢复方案的方法。
- 传输层：负责因特网中两台主机的进程提供通信服务。
- 网络层：选择合适的网间路由和交换节点，确保数据按时成功传送。
- 数据链路层(链路层)：数据链路层将网络层交下来的 IP 数据报组装成帧，在两个相邻节点间的链路上传送帧。
- 物理层：实现计算机节点之间比特流的透明传送，尽可能屏蔽掉具体传输介质和物理设备的差异。该层的主要任务是确定与传输媒体的接口的一些特性（机械特性、电气特性、功能特性，过程特性）





## TCP/IP 五层参考模型

五层体系的协议结构是综合了 OSI 和 TCP/IP 优点的一种协议，包括应用层、传输层、网络层、数据链路层和物理层。其中应用层对应 OSI 的上三层，下四层和 OSI 相同。五层协议的体系结构只是为介绍网络原理而设计的，实际应用还是 TCP/IP 四层体系结构。

- 应用层 ：为特定应用程序提供数据传输服务。

  **协议和工具**：

  - HTTP/HTTPS：用于 Web 浏览
  - FTP：文件传输
  - SMTP/POP3/IMAP：电子邮件
  - DNS：域名解析

  **实例**：Web 浏览器、邮件客户端等。

  

- 传输层 ：为进程提供通用数据传输服务。

  **协议和工具**：

  - TCP：提供可靠、面向连接的数据传输
  - UDP：提供不可靠、无连接的数据传输
  - SCTP：流控制传输协议

  **实例**：Windows 的 Winsock API，Linux 的 socket 编程。

  

- 网络层 ：为主机提供数据传输服务。而传输层协议是为主机中的进程提供数据传输服务。

  **协议和工具**：

  - IP：互联网协议，用于寻址和路由
  - ICMP：用于发送错误消息和网络故障排除
  - OSPF：开放最短路径优先，一种路由协议

  **实例**：路由器、IP 地址、子网掩码

  

- 数据链路层 ：网络层针对的还是主机之间的数据传输服务，而主机之间可以有很多链路，链路层协议就是为同一链路的主机提供数据传输服务。

  **协议和工具**：

  - Ethernet：最常用的局域网技术
  - Wi-Fi：无线局域网
  - PPP：点对点协议

  **实例**：交换机、网桥、MAC 地址。

  

- 物理层 ：负责比特流在传输介质上的传播。

  **工具和技术**：

  - RJ45 连接器：用于以太网
  - 光纤：用于高速数据传输
  - 调制/解调器：用于模拟信号的数字化

  **实例**：网线、网卡、集线器。

  

<img src="C:\Users\hongj\AppData\Roaming\Typora\typora-user-images\image-20231024143257920.png" alt="image-20231024143257920" style="zoom:67%;" />

## 数据如何在各层直接传输

![image-20231024143950906](C:\Users\hongj\AppData\Roaming\Typora\typora-user-images\image-20231024143950906.png)

假设一个主机上的一个应用向另一个主机的一个应用发送数据。

- 在发送**主机端**，一个**应用层报文**被传送到**传输层**。在最简单的情况下，传输层收取到报文并附上附加信息，该首部将被接收端的传输层使用。
- 用**层报文和传输层首部信息**一道构成了**传输层报文段**。附加的信息可能包括：允许接收端传输层向上向适当的应用程序交付报文的信息以及差错检测位信息。该信息让接收端能够判断报文中的比特是否在途中已被改变。
- 传输层则向**网络层**传递该报文段，**网络层增加了如源和目的端系统地址等网络层首部信息**，生成了网络层数据报文。
- 该数据报文接下来被传递给**链路层**，在数据链路层数据包添加发送**端 MAC 地址和接收端 MAC 地址**后被封装成**数据帧**。
- 在物理层数据帧被封装成**比特流**，之后通过传输介质传送到对端。而在接收主机端，整个过程正好反过来。



# 第二部分：应用层

**本章高频面试题**

- uri 和 url 的区别 ？
- dns 是啥工作原理，主要解析过程是啥？
- 用户输入网址到显示对应页面的全过程是啥？
- http 头部包含哪些信息？
- http 方法了解哪些？
- http 状态码了解哪些？
- get 和 post 的区别？
- https 和 https 的区别？
- https 的加密方式？
- http 是不保存状态的协议,如何保存用户状态？
- http 不同版本的区别？

## 万维网和域名系统

万维网 `(WWW，World Wide Web)`，通常称为 `Web`，是一种信息系统，使文档和其他 `Web`资源能够通过 `Internet` 访问。

### 网络资源

网络上的资源必须有一个唯一的表示，才可以在网络上被访问。

uri(uniform resource identifier) 统一资源标识符。
url(uniform resource location) 统一资源定位符，统指绝对路径。
urn(uniform resource name) 统一资源名。

三者之间关系为， url 和 urn 分别是 URI 的子集 。

<img src="https://pic.leetcode.cn/1676185149-fdgRhJ-image-20230211152708228.png" alt="image-20230211152708228.png" style="zoom: 50%;" />

其中 URN 还处于实验阶段，未大范围进行使用，目前使用最多的是 url。url 由三部分组成。

方案，一般是访问资源使用的协议类型，比如http://、https://。
服务器的 web 地址，可以为域名或者 ip 地址 + 端口号，比如 localhost:8080 或者 127.0.0.1:8080。不添加默认为 80 ，这是访问域名不用加端口号的原因 。
web 服务器上的某个资源，比如leetbook/read/networks-interview-highlights。

注意： url是否以/结尾，意义是不同的，用户无感知的原因是因为服务器自动处理了这种差异。



### 应用程序体系架构

应用程序体系体系架构主要分为两种。

**C/S(client/server)** ：客户端之间不进行通信，客户端向服务端发送请求获取数据，服务器要一直开机，需要配备大量的数据中心。比如：微信，google，bing等等。
**P2P(peer to peer)** ：对等通信，不需要数据中心，没有客户端和服务端的区别，应用程序在间断连接的主机对之间直接通信。主要应用在流量密集型应用。比如：迅雷，bitTorrent，或者在局域网的文件内部共享应用中。
目前大型互联网应用主要采用的是 C/S 架构，导致 P2P 架构逐渐被人遗忘。 C/S 架构又可以细分为 C/S(client/server) 和 B/S(browser/server)，即根据客户端类型划分。

**本地客户端：**速度快，安全，灵活性较高，但是开发成本就高，比如游戏客户端。
**浏览器：**不需要安装，依托于浏览器，安全性较低，成本极低。

### `web`的结构组件

web 是极为复杂的，不仅只有 client 与 server 之间简单的请求响应 ，还包含了一些特殊的 **server** ，他们承担着一些特殊的作用。

**代理**：位于客户端和服务器之间的 http中间实体。

出于安全考虑，通常会将代理做为转发所有 Web 流量的可信任中间节点使用，可以对请求和响应进行过滤。比如，校园网中可以过滤一些不健康的内容，禁止学生进行访问。

<img src="C:\Users\hongj\AppData\Roaming\Typora\typora-user-images\image-20231024152329210.png" alt="image-20231024152329210" style="zoom: 33%;" />

**网关**：连接其他应用程序的特殊 web 服务器。

做为其他服务器的中间实体使用。常用于将 http 流量转化为其他的协议。网关接受请求时就好像自己本身是资源源服务器一样，客户端对此无感知。

<img src="C:\Users\hongj\AppData\Roaming\Typora\typora-user-images\image-20231024152343468.png" alt="image-20231024152343468" style="zoom: 33%;" />



**隧道**： 对 http通信报文进行盲转发的特殊代理。

对两条连接之间的数据进行盲转发，https就是通过隧道实现的。http连接承载加密的安全套接字层`(ssl,secure sockets layer)流量，这样 ssl 流量就可以直接穿过只允许 web 流量通过防火墙，反正亦然。

<img src="C:\Users\hongj\AppData\Roaming\Typora\typora-user-images\image-20231024153519458.png" alt="image-20231024153519458" style="zoom: 50%;" />



**代理服务器在 Web 网站中的可能作用：**

1. **内容缓存**：代理服务器可以缓存来自 Web 服务器的响应数据，当其他用户请求相同的内容时，直接从缓存中提供，减少了 Web 服务器的负担。
2. **访问控制**：代理服务器可以限制哪些 IP 地址可以或不能访问特定的 Web 资源。
3. **负载均衡**：代理服务器可以将进入的请求分配到多个后端服务器，以分散负载。

**网关在 Web 网站中的可能作用：**

1. **API 网关**：在微服务架构中，API 网关作为前端和多个微服务之间的接口，负责请求的路由、组合和转换。
2. **安全网关**：可以作为防火墙的一部分，阻止某些类型的攻击，如 SQL 注入和跨站脚本（XSS）。

假设你有一个电商网站，后端由多个微服务组成：用户服务、订单服务、库存服务等。

- **代理服务器**：当用户浏览商品时，代理服务器从库存服务获取数据并将其缓存。下一个用户查询相同的商品时，代理服务器直接从缓存提供数据，减少了实际的服务请求。
- **API 网关**：当用户下订单时，前端通过 API 网关发送一个请求。网关收到请求后，首先查询用户服务验证用户身份，然后将订单数据路由到订单服务，并且检查库存服务以确认商品可用性。

这样，代理服务器和 API 网关各自扮演了非常重要的角色，优化了性能，提高了安全性，简化了前端与各个微服务之间的交互。



### `dns`域名系统

域名系统 (dns,domain name system) 是 Internet 或其他 Internet 协议（ip） 网络中计算机、服务和其他资源的分层分布式命名系统。它将各种信息与分配给每个关联实体的域名相关联。最重要的是，它将容易记忆的域名转换为数字ip地址，用于定位和识别具有底层网络协议的计算机服务和设备。

**dns的作用**
在dns 出现之前，互联网中某台主机的唯一标识是这台机器的 ip 地址，但是这种方式记起来很麻烦，人们更喜欢便于记忆的名称。为了解决这个问题，人们需要一种从主机名称到 ip 地址转换的服务，域名系统作为将域名和 ip 地址相互映射的一个分布式数据库，能够使人更方便地访问互联网。

小提示：dns域名支持中文字符

**dns 服务器的结构**
dns域名的结构是 xxx.xxx.xxx，是分层的。分为顶级域名（一级域名），二级域名，三级域名 . . . . .

顶级域名会根据国家地区，或者组织进行划分,比如cn（代表中国）、edu（代表教育组织）。二级域名就是在顶级域名前面加前缀,比如 leetcode.cn。也正因为如此，dns服务器的结构是树状的。

**域名以及服务器结构**

![image-20231024154234714](C:\Users\hongj\AppData\Roaming\Typora\typora-user-images\image-20231024154234714.png)

**顶级域名、一级域名**

　　Top-level domains，first-level domains（TLDs），也翻译为国际顶级域名，也成一级域名。

　　.com 供商业机构使用，但无限制最常用
　　.net 原供网络服务供应商使用，现无限制
　　.org 原供不属于其他通用顶级域类别的组织使用，现无限制
　　.edu / .gov / .mil 供美国教育机构/美国政府机关/美国军事机构。因历史遗留问题一般只在美国专用
　　.aero 供航空运输业使用
　　.biz 供商业使用
　　.coop 供联合会（cooperatives）使用
　　.info 供信息性网站使用，但无限制
　　.museum 供博物馆使用
　　.name 供家庭及个人使用
　　.pro 供部分专业使用
　　.asia 供亚洲社区使用
　　.tel 供连接电话网络与因特网的服务使用
　　.post 供邮政服务使用
　　.mail 供邮件网站使用
　　国家顶级域名：cn（中国大陆）、de（德国）、eu（欧盟）、jp（日本）、hk（中国香港）、tw（中国台湾）、uk（英国）、us（美国）



**二级域名**

　　二级域（或称二级域名；英语：Second-level domain；英文缩写：SLD）是互联网DNS等级之中，处于顶级域名之下的域。二级域名是域名的倒数第二个部分，例如在域名example.baidu.com中，二级域名是Baidu。

　　.com 顶级域名/一级域名，更准确的说叫顶级域

　　baidu.com 二级域名，更准确的说叫二级域

　　tieba.baidu.com 三级域名，更准确的说叫三级域

　　detail.tieba.baidu.com 四级域名，更准确的说叫四级域



**子域名**

　　子域名（或子域；英语：Subdomain）是在域名系统等级中，属于更高一层域的域。比如，mail.example.com和calendar.example.com是example.com的两个子域，而example.com则是顶级域.com的子域。凡顶级域名前加前缀的都是该顶级域名的子域名，而子域名根据技术的多少分为二级子域名，三级子域名以及多级子域名。



**准确理解一级域名**

![img](https://img2018.cnblogs.com/blog/955092/201912/955092-20191203101440732-1723526319.jpg)

　　通常我们把.com成为一级域名，但严格意义上这样讲不太准确，真正的一级域名是由一个合法的字符串+域名后缀组成，所以，guanghe.com这种形式的域名才是一级域名，guanghe是域名主体，.com是域名后缀，我们也可以把.com也称为顶级域。

　　*一级域名又称为顶级域名，比如单独的gunaghe.com如果指向一个ip，这个域名就是一级域名。但需要注意的是，www.guanghe.com这种形式的域名并不是一级域名，它只是一个二级域名，也就是说www只是一个主机名。*

### dns 的原理

以一个例子来了解 dns 的工作原理。

假设一个客户端 A，想要查询 a.leetcode.cn 的 ip 地址，考虑**缓存**的情况。

客户端 A 首先查询本地的 **hosts** 文件，查询是否有网址映射关系，如果没有，进行下一步查找。
查找本地的 dns 解析器缓存，如果没有进行下一步。
根据 tcp/ip 参数查找设置好的首选 dns 服务器 ip 地址，一般叫做本地 dns 服务器，查询本地 dns 服务器。本地 dns 服务器如果没有，它就会进行下一步操作。
本地dns会访问根服务器 ，然后根据后缀名，从根服务器中查找对应的顶级域名服务器的 ip ，然后以此向下查找域名服务器的 ip ，然后查找网址映射关系,直到找到为止。

<img src="https://pic.leetcode.cn/1676185377-UniHCX-image-20230212134234075.png" alt="image-20230212134234075.png" style="zoom:50%;" />

> 客户端 A 向本地域名服务器查询为递归查询，本地域名服务器向根域名服务器查询为迭代查询。
>
> **递归查询（Recursive Query）**
>
> 1. **全权负责**: 在递归查询中，客户端向本地域名服务器（通常是ISP提供的DNS服务器或企业内部的DNS服务器）发出查询请求后，该服务器负责完成整个查询过程。它会一步步从根域名服务器开始，找到负责特定域名的权威服务器，直至获得最终的IP地址。
> 2. **一对一关系**: 客户端只与本地域名服务器进行交互，不需要知道其他服务器的信息。
> 3. **响应时间**: 通常来说，递归查询可能需要更多的时间，因为本地域名服务器需要与多个外部服务器进行通信。
> 4. **缓存**: 为了提高效率，本地域名服务器会缓存查询结果。下次相同的查询来临时，可以直接从缓存中获取答案，而无需再进行完整的递归查询。
>
> **迭代查询（Iterative Query）**
>
> 1. **逐步解析**: 在迭代查询中，本地域名服务器向根域名服务器发出查询后，根服务器会返回一个指向下一级域名服务器的引用。然后本地域名服务器会向这个下一级服务器发出查询，如此反复，直到找到负责特定域名的权威服务器。
> 2. **多对多关系**: 本地域名服务器需要与多个其他域名服务器进行交互。
> 3. **服务器负担**: 由于每个服务器只负责解析自己管理的域名信息，因此相对于递归查询，迭代查询减轻了各个服务器的负担。
> 4. **无缓存**: 在迭代查询过程中，除非本地域名服务器自己决定缓存某些信息，否则通常不会进行缓存。
>
> **总结**
>
> - 递归查询通常用于客户端和本地域名服务器之间的交互，因为客户端希望简单地获取一个答案。
> - 迭代查询通常用于域名系统内部各个服务器之间的交互，以减轻单个服务器的负担并提高整体效率。



### dns 数据传输

dns 的数据传输是采用 tcp 协议还是 udp 协议 ，或者是其他的什么协议 ？

dns 既采用 udp 协议也采用 tcp 协议:

dns 是通过 53 端口进行通信，默认是采用 udp 协议进行数据传输的，除了个别情况，也就是说绝大多数情况是采用 udp 进行传输。
使用 tcp 传输的情况:
当返回的响应超过的 512 字节（ udp 最大只支持 512 字节的数据）。
区域传送：主域名服务器向辅助域名服务器传送变化的那部分数据。
注意: tcp 协议和 tcp 协议是可以同时绑定同一个端口的。
区域传输: dns 服务器中数据不总是一成不变的，域名数量是不断增加，而且一些域名对应着的服务器的也是在变化的，所以其实 dns 服务器中的数据是不断增加的，并且随时流动的，所以可以将区域传输简单理解为 dns 服务器之间进行的数据传输。



### dns 域名服务器名称概念

根域名服务器：最高层次的域名服务器，所有的根域名服务器都知道所有的顶级域名服务器的ip地址，全球有 13 个根域名服务器。

顶级域名服务器：负责处理所有顶级域名，提供到权威域服务器的映射。

授权(权威)域名服务器：提供主机名到 IP 地址间的映射服务

主域名服务器：一个或多个区域域名解析工作的主要域名服务器，通常也是一个或多个区域的授权域名服务器。

辅助域名服务器：协助主域名服务器提供域名查询服务，在主机很多的情况下，可以有效分担主域名服务器的压力。当主域名服务器故障时，辅助域名服务器能够在数据有效期内继续为主机提供域名解析服务。



## HTTP

### HTTP报文结构

第一部分简略信息，包含请求方法、url 和协议版本；或者协议版本和状态码
第二部分为请求首部 Header 或者响应首部 Header;
第三部分为内容主体

```html
// 第一部分：简略信息
GET https://leetcode.cn/problemset/all/ HTTP/1.1.  
// 第二部分：请求首部或者响应首部
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Cache-Control: max-age=0
Host: leetcode.cn
If-Modified-Since: Thu, 17 Oct 2019 07:18:26 GMT
If-None-Match: "3147526947+gzip"
Proxy-Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 xxx
// --------- 空行 --------------
// 第三部分，内容主体
param1=1&param2=2。
```

### http 请求方法

![image.png](https://pic.leetcode.cn/1676723681-NvPiMa-image.png)

http 请求方法是为了服务器功能实现起来更方便，但不意味着每种特定的方法只能实现某种特定的功能。http 方法设计较为灵活，方法本身虽然有一些规则，但是最重要的还是开发者如何开发设计，正因为如此，不同的浏览器和不同的服务器会有一些限制，但是这和 http 方法关系不大。比如：

- 有些服务器不支持**get** 方法设置 **body**，对于这种服务器，get 方法通常是通过以 **url** 的 **parameters** 或者 Anchor 进行传递数据的

![image-20230212181050545.png](https://pic.leetcode.cn/1676723874-JxlETu-image-20230212181050545.png)

也就是说 get 方法传递数据的大小和 url 的长度直接相关，url 本身并没有对长度进行限制，但是*浏览器会对 url 进行限制*，比如 FireFox 限制 url 的最大长度为 65536 个字符，也就是 64KB的大小，而 Chrome 限制 url 最大长度为 8182个字符，也就是 8 KB 的大小。

- **post** 方法向服务器发送数据是通过 **body** ，post 方法本身对 body 的大小也没有限制，但是不同的服务器处理的能力是不同的，较为强大的服务器可以接收几十 GB 的数据，而一些服务器最多只能接收几十 MB 的数据。

- **get 和 post 的差别**

